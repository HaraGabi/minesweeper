!function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=1)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){this.marked=e};t.UnknownCell=n;var o=function(e){this.mineCount=e};t.OpenCell=o;var r=function(){};t.ExplodedCell=r;var s=function(){function e(e,t,i){this.width=e,this.height=t,this.mineCount=i,this.remainingToOpen=e*t-i,this.gameConclusion=null,this.stateMap=new Array(t);for(var n=0;n<t;n++)this.stateMap[n]=new Array(e);this.mineMap=null}return Object.defineProperty(e.prototype,"conclusion",{get:function(){return this.gameConclusion},enumerable:!0,configurable:!0}),e.prototype.getCellAt=function(e,t){var i=this.stateMap[t][e];if("revealed"!==i)return new n("marked"===i);if(!this.mineMap)throw"mineMap should be initialized before any cell state is revealed.";var s=this.mineMap[t][e];return"bomb"===s?new r:new o(s)},e.prototype.tryToggleMark=function(e,t){var i=this.stateMap[t][e];return"revealed"!==i&&(this.stateMap[t][e]="marked"===i?void 0:"marked",!0)},e.prototype.tryOpen=function(e,t){var i=this.stateMap[t][e];if("revealed"===i||"marked"===i)return!1;if(null===this.mineMap&&this.initializeMines({x:e,y:t}),!this.mineMap)throw"mineMap should be initialized before any cell state is revealed.";return"bomb"===this.mineMap[t][e]?this.explode():this.openKnownGoodCell(e,t),!0},e.prototype.openSurroundingIfSatisfied=function(e,t){var i=this.getCellAt(e,t);if(i instanceof o){for(var n=this.getSurroundingCoordinates(e,t),r=new Array,s=0,h=0;h<n.length;h++){var a=n[h],l=this.stateMap[a.y][a.x];"marked"===l?s++:"revealed"!==l&&r.push(a)}if(s===i.mineCount){for(h=0;h<r.length;h++){a=r[h];if(this.tryOpen(a.x,a.y),this.gameConclusion)break}return!0}}return!1},e.prototype.initializeMines=function(e){this.mineMap=new Array(this.height);for(var t=0;t<this.height;t++)this.mineMap[t]=new Array(this.width).fill(0);for(var i=0;i<this.mineCount;){var n=Math.floor(Math.random()*this.width);t=Math.floor(Math.random()*this.height);if(!(Math.abs(n-e.x)<=1&&Math.abs(t-e.y)<=1)&&"bomb"!==this.mineMap[t][n]){this.mineMap[t][n]="bomb";for(var o=this.getSurroundingCoordinates(n,t),r=0;r<o.length;r++){var s=o[r],h=this.mineMap[s.y][s.x];"bomb"!==h&&(this.mineMap[s.y][s.x]=h+1)}i++}}console.log(this.mineMap)},e.prototype.explode=function(){if(!this.mineMap)throw"mineMap should be initialized before any cell state is revealed.";this.gameConclusion="loss";for(var e=0;e<this.height;e++)for(var t=0;t<this.width;t++)"bomb"===this.mineMap[e][t]&&(this.stateMap[e][t]="revealed")},e.prototype.openKnownGoodCell=function(e,t){if(!this.mineMap)throw"mineMap should be initialized before any cell state is revealed.";for(var i=[{x:e,y:t}];;){var n=i.pop();if(!n)break;var o=this.stateMap[n.y][n.x];if("marked"!==o&&"revealed"!==o){if(this.stateMap[n.y][n.x]="revealed",this.remainingToOpen--,0===this.remainingToOpen){this.gameConclusion="win";break}0===this.mineMap[n.y][n.x]&&(i=i.concat(this.getSurroundingCoordinates(n.x,n.y)))}}},e.prototype.getSurroundingCoordinates=function(e,t){var i=new Array;return t>0&&i.push({x:e,y:t-1}),t<this.height-1&&i.push({x:e,y:t+1}),e>0&&(i.push({x:e-1,y:t}),t>0&&i.push({x:e-1,y:t-1}),t<this.height-1&&i.push({x:e-1,y:t+1})),e<this.width-1&&(i.push({x:e+1,y:t}),t>0&&i.push({x:e+1,y:t-1}),t<this.height-1&&i.push({x:e+1,y:t+1})),i},e}();t.Game=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),o=i(2),r=new n.Game(30,16,99);new o.Renderer(r,document.getElementById("minefield-container"))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),o=i(3),r=function(){function e(e,t){var i=this;this.mouseDownCell=null,this.isMouseCaptured=!1,this.game=e;var n=document.createElement("canvas"),o=n.getContext("2d");if(!o)throw"Unable to obtain a 2D drawing context.";this.context=o,this.minefieldContainer=t,t.appendChild(n),window.addEventListener("resize",(function(){return i.refreshCanvasLayout()})),this.refreshCanvasLayout(),n.addEventListener("mousedown",(function(e){return i.onMouseDown(e)})),n.addEventListener("mousemove",(function(e){return i.onMouseMove(e)})),n.addEventListener("mouseup",(function(e){return i.onMouseUp(e)})),n.addEventListener("dblclick",(function(e){return i.onDoubleClick(e)})),window.addEventListener("contextmenu",(function(e){return e.preventDefault()}),!1)}return e.prototype.refreshCanvasLayout=function(){var e=window.devicePixelRatio||1,t=this.minefieldContainer.clientWidth*e,i=this.minefieldContainer.clientHeight*e;if(!this.layout||this.layout.renderSize.width!==t||this.layout.renderSize.height!==i){this.layout=new o.MinesweeperLayout(t,i,this.game.width,this.game.height);var n=this.context.canvas;n.style.width=this.minefieldContainer.clientWidth+"px",n.style.height=this.minefieldContainer.clientHeight+"px",n.width=t,n.height=i,this.render()}},e.prototype.onMouseDown=function(e){if(!this.game.conclusion)if(0===e.button)this.isMouseCaptured=!0,this.updateMouseDownCell(e);else if(2===e.button){var t=this.getCellByMouseLocation(e);t&&this.game.tryToggleMark(t.x,t.y)&&this.render()}},e.prototype.onMouseMove=function(e){this.isMouseCaptured&&this.updateMouseDownCell(e)},e.prototype.onMouseUp=function(e){0===e.button&&(this.isMouseCaptured=!1,this.mouseDownCell&&(this.game.tryOpen(this.mouseDownCell.x,this.mouseDownCell.y),this.mouseDownCell=null,this.render()))},e.prototype.onDoubleClick=function(e){if(!this.game.conclusion&&0===e.button){var t=this.getCellByMouseLocation(e);t&&this.game.openSurroundingIfSatisfied(t.x,t.y)&&this.render()}},e.prototype.updateMouseDownCell=function(t){var i=this.getCellByMouseLocation(t);e.areSame(i,this.mouseDownCell)||(this.mouseDownCell=i,this.render())},e.areSame=function(e,t){return e?!!t&&(e.x===t.x&&e.y===t.y):!t},e.prototype.getCellByMouseLocation=function(e){var t=window.devicePixelRatio||1;return this.layout.getCellCoordinatesByMouseLocation({x:e.offsetX*t,y:e.offsetY*t})},e.prototype.render=function(){var e=this.layout,t=e.renderSize,i=e.minefieldBounds,n=e.cellSize;this.context.clearRect(0,0,t.width,t.height),this.context.fillStyle="#d0d0d0",this.context.fillRect(i.x,i.y,i.width,i.height),this.context.strokeStyle="#a0a0a0";for(var o=0;o<this.game.height;o++){var r=this.layout.getCellBorderY(o);this.context.beginPath(),this.context.moveTo(i.x,r),this.context.lineTo(i.x+i.width,r),this.context.stroke()}for(var s=0;s<this.game.width;s++){var h=this.layout.getCellBorderX(s);this.context.beginPath(),this.context.moveTo(h,i.y),this.context.lineTo(h,i.y+i.height),this.context.stroke()}this.context.font="bold "+.5*n+"px Georgia";for(o=0;o<this.game.height;o++)for(s=0;s<this.game.width;s++)this.drawCell({x:s,y:o},this.layout.getCellBounds(s,o),n)},e.prototype.drawCell=function(e,t,i){var o=e.x,r=e.y,s=this.mouseDownCell&&this.mouseDownCell.x===o&&this.mouseDownCell.y===r,h=this.game.getCellAt(o,r);if(h instanceof n.UnknownCell&&(h.marked||!s)){var a=.1*i,l=t.x+t.width,u=t.y+t.height;this.context.beginPath(),this.context.moveTo(t.x,t.y),this.context.lineTo(t.x,u),this.context.lineTo(t.x+a,u-a),this.context.lineTo(t.x+a,t.y+a),this.context.lineTo(l-a,t.y+a),this.context.lineTo(l,t.y),this.context.closePath(),this.context.fillStyle="#e8e8e8",this.context.fill(),this.context.beginPath(),this.context.moveTo(l,u),this.context.lineTo(l,t.y),this.context.lineTo(l-a,t.y+a),this.context.lineTo(l-a,u-a),this.context.lineTo(t.x+a,u-a),this.context.lineTo(t.x,u),this.context.closePath(),this.context.fillStyle="#a0a0a0",this.context.fill()}var d=h instanceof n.UnknownCell?h.marked?"ðŸš©":null:h instanceof n.OpenCell?0!==h.mineCount?h.mineCount.toString():null:"ðŸ’¥";null!==d&&(h instanceof n.OpenCell&&(this.context.fillStyle=["blue","green","#e00","darkblue","brown","darkcyan","black","gray"][h.mineCount-1]),this.drawCenteredText(d,t))},e.prototype.drawCenteredText=function(e,t){var i=this.context.measureText(e);this.context.textBaseline="middle",this.context.fillText(e,t.x+(t.width-i.width)/2,t.y+t.height/2)},e}();t.Renderer=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(t,i,n,o){this.renderSize={width:t,height:i},this.gameSize={width:n,height:o};var r={x:0,y:0,width:this.renderSize.width,height:this.renderSize.height},s={width:n,height:o};this.minefieldBounds=e.fitRectangle(s,r),this.cellSize=this.minefieldBounds.width/n}return e.prototype.getCellCoordinatesByMouseLocation=function(e){var t=Math.floor((e.x-this.minefieldBounds.x)/this.cellSize);if(t<0||t>=this.gameSize.width)return null;var i=Math.floor((e.y-this.minefieldBounds.y)/this.cellSize);return i<0||i>=this.gameSize.height?null:{x:t,y:i}},e.prototype.getCellBorderX=function(e){return Math.floor(this.minefieldBounds.x+this.cellSize*e)},e.prototype.getCellBorderY=function(e){return Math.floor(this.minefieldBounds.y+this.cellSize*e)},e.prototype.getCellBounds=function(e,t){var i=this.getCellBorderX(e),n=this.getCellBorderY(t);return{x:i,y:n,width:this.getCellBorderX(e+1)-i,height:this.getCellBorderY(t+1)-n}},e.fitRectangle=function(e,t){if(t.width*e.height<t.height*e.width){var i=t.width*e.height/e.width;return{x:0,y:(t.height-i)/2,width:t.width,height:i}}var n=t.height*e.width/e.height;return{x:(t.width-n)/2,y:0,width:n,height:t.height}},e}();t.MinesweeperLayout=n}]);
//# sourceMappingURL=bundle.js.map